<script>
(function () {
    const toggle_switch = document.getElementById('toggle-dark');
    const isDark = window.matchMedia('(prefers-color-scheme: dark)');
    const htmlElement = document.documentElement;
    const keyLocalStorage = 'theme';
    const localTheme = localStorage.getItem(keyLocalStorage);

    if(localTheme === 'dark') {
        changeMode('dark');
    } else if(localTheme === 'light') {
        changeMode('light');
    } else if(isDark.matches) {
        changeMode('dark');
    }

    toggle_switch.addEventListener('change', function(){
        if(toggle_switch.checked){
            changeMode('dark');
            localStorage.setItem(keyLocalStorage,'dark');
        } else {
            changeMode('light');
            localStorage.setItem(keyLocalStorage,'light');
        }
    });
    isDark.addListener(e => {
        if (e.matches) {
            changeMode('dark');
            localStorage.removeItem(keyLocalStorage);
        } else {
            changeMode('light');
            localStorage.removeItem(keyLocalStorage);
        }
    })

    function changeMode(mode){
        if(mode === 'dark') {
            htmlElement.dataset.mode = 'dark';
            toggle_switch.checked = true;
        } else if(mode === 'light') {
            delete htmlElement.dataset.mode;
            toggle_switch.checked = false;
        }
    }
}());
</script>
<% if(is_category() || is_post()) { %>
    <script>
      if(<%- is_category() %> && <%- page.current === 1 %>){ var i = 1;}else{ var i = 2;}
      document.querySelector('.category-list [href="' + encodeURI(document.querySelector('.breadcrumbs__item:nth-last-of-type(' + i +') a').getAttribute('href')) + '"]').setAttribute('class', 'category-list-link current');</script>
<% } %>
<% if(page.js === true) { %>
    <script src="/<%= page.path %>script.js"></script>
<% } %>
<script>
function lazyLoad(scriptSrc, type) {
    var scrollFirstTime = 1;
    window.addEventListener("scroll", oneTimeFunction, false);
    window.addEventListener("mousemove", oneTimeFunction, false);
    window.addEventListener("mousedown", oneTimeFunction, false);
    window.addEventListener("touchstart", oneTimeFunction, false);

    function oneTimeFunction() {
        if (scrollFirstTime === 1) {
            scrollFirstTime = 0;
            var adScript = document.createElement("script");
            if(type === "src"){
                adScript.src = scriptSrc;
            } else if(type === "inline"){
                adScript.innerHTML = scriptSrc;
            } else if(type === "ad"){
                adScript.src = scriptSrc;
                adScript.setAttribute("data-ad-client", "ca-pub-9027963984337121");
            }
            adScript.setAttribute("async", "async");
            document.body.appendChild(adScript);
            window.removeEventListener("scroll", oneTimeFunction, false);
            window.removeEventListener("mousemove", oneTimeFunction, false);
            window.removeEventListener("mousedown", oneTimeFunction, false);
            window.removeEventListener("touchstart", oneTimeFunction, false);
        }
    }
}
<% if(is_post()) { %>lazyLoad("/js/pixel-viewer.js", "src");<% } %>
lazyLoad("https://www.googletagmanager.com/gtag/js?id=UA-68420269-3", "src");
lazyLoad("window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag(\'js\', new Date());gtag(\'config\', \'UA-68420269-3\');", "inline");
lazyLoad("https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js", "ad");
</script>
