<%
// titleの出し分け
    var title;
    if(is_home()){
        title = '';
    } else if (is_archive()){
        title = 'アーカイブ' + ' - ';
    } else if (is_category()){
        title = page.category + ' - ';
    } else if (is_tag()){
        title = page.tag + ' - ';
    } else {
        title = page.title + ' - ';
    }
    if(page.current > 1){
        title += 'ページ'+ page.current + ' - ';
    }
    title += config.title;

// ディスクリプションの設定
    var description;
    if(is_post()){
        if (page.description) {
            description = page.description;
        }else {
            description = page.content.replace(/<("[^"]*"|'[^']*'|[^'">])*>/g,'').slice(0, 110);
        }
    } else {
        description = config.description;
    }
%>

{
  "@context": "http://schema.org",
  "@graph": [
    {
      "@type": "BreadcrumbList",
      "itemListElement":
      [
        {
          "@type": "ListItem",
          "position": 1,
          "item":
          {
            "@id": "/",
            "name": "ホーム"
          }
        }
        <% if (is_home()) { %>
            <% if(page.current !== 1){ %>
                ,{
                  "@type": "ListItem",
                  "position": 2,
                  "item":
                  {
                    "@id": "/page/<%= page.current %>/",
                    "name": "ページ<%= page.current %>"
                  }
                }
            <% } %>
        <% } else if (is_category()) { %>
            <%
            const category_slug = page.path.replace(config.category_dir + '/', '').replace(/\/page\/.+/,'').replace(/\/index.html/, '').split('/');
            let category_url = '';
            %>
            <% category_slug.forEach(function(item, i){ %>
                <%
                i += 2;
                category_url += '/' + item;

                const category_name = Object.keys(config.category_map).filter( (key) => {
                  return config.category_map[key] === item;
                });
                %>
                ,{
                  "@type": "ListItem",
                  "position": <%= i %>,
                  "item":
                  {
                    "@id": "/<%= config.category_dir %><%= category_url %>/",
                    "name": "<% if(category_name.length === 0){ %><%= item %><%}else{%><%= category_name %><%}%>"
                  }
                }
            <% }) %>
            <% if(page.current !== 1){ %>
                ,{
                  "@type": "ListItem",
                  "position": <%= category_slug.length + 2 %>,
                  "item":
                  {
                    "@id": "/<%= config.category_dir %><%= category_url %>/page/<%= page.current %>/",
                    "name": "ページ<%= page.current %>"
                  }
                }
            <% } %>
        <% } else if (is_tag()) { %>
                ,{
                  "@type": "ListItem",
                  "position": 2,
                  "item":
                  {
                    "@id": "",
                    "name": "タグ"
                  }
                }
                ,{
                  "@type": "ListItem",
                  "position": 3,
                  "item":
                  {
                    "@id": "/<%= config.tag_dir %>/<%= page.tag %>/",
                    "name": "<%= page.tag %>"
                  }
                }
            <% if(page.current !== 1){ %>
                ,{
                  "@type": "ListItem",
                  "position": 4,
                  "item":
                  {
                    "@id": "/<%= config.tag_dir %>/<%= page.tag %>/page/<%= page.current %>/",
                    "name": "ページ<%= page.current %>"
                  }
                }
            <% } %>
        <% } else if (is_archive()) { %>
            ,{
              "@type": "ListItem",
              "position": 2,
              "item":
              {
                "@id": "/<%= config.archive_dir %>/<%= page.year %>/",
                "name": "<%= page.year %>年"
              }
            }
            <% if(page.month){ %>
            ,{
              "@type": "ListItem",
              "position": 3,
              "item":
              {
                "@id": "<%- url_for(path) %>",
                "name": "<%= page.month %>月"
              }
            }
            <% } %>
        <% } else if(is_post()) { %>
            <% page.categories.forEach(function(item, i){ %>
                <%
                i += 2;
                %>
                ,{
                  "@type": "ListItem",
                  "position": <%= i %>,
                  "item":
                  {
                    "@id": "<%= url_for(item.path) %>",
                    "name": "<%= item.name %>"
                  }
                }
            <% }) %>
            ,{
              "@type": "ListItem",
              "position": <%= page.categories.length + 2 %>,
              "item":
              {
                "@id": "<%- url_for(path) %>",
                "name": "<%- page.title %>"
              }
            }
        <% } else if (is_page()) { %>
            ,{
              "@type": "ListItem",
              "position": 2,
              "item":
              {
                "@id": "<%- url_for(path) %>",
                "name": "<%- page.title %>"
              }
            }
        <% } %>
      ]
    } <% if(!is_post()) { %>,
    {
      "@type": "Blog",
      "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "<%- url_for(path) %>"
      },
      "headline": "<%- title %>",
      "image": {
          "@type": "ImageObject",
          "url": "https://pixelog.net/img/pixelog.png",
          "width": 1200,
          "height": 630
      },
      "author": {
          "@type": "Person",
          "name": "<%= config.author %>"
      },
      "publisher": {
          "@type": "Organization",
          "name": "<%= config.title %>",
          "logo": {
              "@type": "ImageObject",
              "url": "https://pixelog.net/img/pixelog.png",
              "width": 1200,
              "height": 630
          }
      },
      "description": "<%= description %>"
    } <% } else if(is_post()) { %>,
    {
      "@type": "BlogPosting",
      "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "<%- url_for(path) %>"
      },
      "headline": "<%= title %>",
      "datePublished": "<%= page.date.format() %>",
      "dateModified": "<%= page.updated.format() %>",
      "description": "<%= description %>",
      "image": {
        "@type": "ImageObject",
        "url": "https://pixelog.net/img/pixelog.png",
        "width": 1200,
        "height": 630
      },
      "author": {
        "@type": "Person",
        "name": "<%= config.author %>"
      },
      "publisher": {
        "@type": "Organization",
        "name": "<%= config.title %>",
        "logo": {
          "@type": "ImageObject",
          "url": "https://pixelog.net/img/pixelog.png",
          "width": 1200,
          "height": 630
        }
      }
    }
    <% } %>
  ]
}
