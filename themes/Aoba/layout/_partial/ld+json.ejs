<%
// titleの出し分け
    var title;
    if(is_home()){
        title = '';
    } else if (is_archive()){
        title = 'アーカイブ' + ' - ';
    } else if (is_category()){
        title = page.category + ' - ';
    } else if (is_tag()){
        title = page.tag + ' - ';
    } else {
        title = page.title + ' - ';
    }
    if(page.current > 1){
        title += 'ページ'+ page.current + ' - ';
    }
    title += config.title;

// ディスクリプションの設定
    var description;
    if(is_post()){
        if (page.description) {
            description = page.description;
        }else {
            description = page.content.replace(/<("[^"]*"|'[^']*'|[^'">])*>/g,'').slice(0, 110);
        }
    } else {
        description = config.description;
    }

// パンくずリスト
    let breadcrumbs = {};

    if(is_post()) {
        page.categories.forEach(function(item){
            breadcrumbs[item.name] = url_for(item.path);
        })
        breadcrumbs[page.title] = url_for(path);
    } else if (is_page()) {
        breadcrumbs[page.title] = url_for(path);
    } else if (is_category()) {
        let cat = {};
        cat = get_category(cat);
        for(var key in cat) {
            breadcrumbs[key] = cat[key];
        }
    } else if (is_tag()) {
        breadcrumbs['#'+page.tag] = url_for(path);
    } else if (is_archive()) {
        breadcrumbs['アーカイブ'] = '/' + config.archive_dir + '/';
        if(page.year){
            breadcrumbs[page.year+'年'] = '/' + config.archive_dir + '/' + page.year + '/';
        }
        if(page.month){
            breadcrumbs[page.month+'月'] = url_for(path);
        }
    }
    if(page.current && page.current !== 1){
        breadcrumbs['ページ'+page.current] = '/page/' + page.current + '/';
    }

    function reverse_array(a) {
        var key = [];
        for (var i in a) {
            key.push(i);
        }
        key.reverse();
        var ret = [];
        for (var i in key) {
            ret[key[i]] = a[key[i]];
        }
        return ret;
    }

    function get_category(arr){
        arr[page.category] = decodeURI(url_for(page.path));
        get_parent(page.category);

        function get_parent(current){
            const current_cat = site.categories.data.filter(x => x.name === current );
            const parent_id = current_cat[0].parent;

            if(parent_id) {
                const parent_name = site.categories.data.filter(x => x._id === parent_id);
                arr[parent_name[0].name] = decodeURI(url_for(parent_name[0].path));
                get_parent(parent_name[0].name);
            }
        }
        return reverse_array(arr);
    }
%>

{
  "@context": "http://schema.org",
  "@graph": [
    {
      "@type": "BreadcrumbList",
      "itemListElement":
      [
        {
          "@type": "ListItem",
          "position": 1,
          "item":
          {
            "@id": "/",
            "name": "ホーム"
          }
        }
        <% let i = 1; %>
        <% for(var key in breadcrumbs) { %>
        <% i += 1 %>
        ,{
          "@type": "ListItem",
          "position": <%= i %>,
          "item":
          {
            "@id": "<%= breadcrumbs[key] %>",
            "name": "<%= key %>"
          }
        }
        <% } %>
      ]
    } <% if(!is_post()) { %>,
    {
      "@type": "Blog",
      "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "<%- url_for(path) %>"
      },
      "headline": "<%- title %>",
      "image": {
          "@type": "ImageObject",
          "url": "https://pixelog.net/img/pixelog.png",
          "width": 1200,
          "height": 630
      },
      "author": {
          "@type": "Person",
          "name": "<%= config.author %>"
      },
      "publisher": {
          "@type": "Organization",
          "name": "<%= config.title %>",
          "logo": {
              "@type": "ImageObject",
              "url": "https://pixelog.net/img/pixelog.png",
              "width": 1200,
              "height": 630
          }
      },
      "description": "<%= description %>"
    } <% } else if(is_post()) { %>,
    {
      "@type": "BlogPosting",
      "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "<%- url_for(path) %>"
      },
      "headline": "<%= title %>",
      "datePublished": "<%= page.date.format() %>",
      "dateModified": "<%= page.updated.format() %>",
      "description": "<%= description %>",
      "image": {
        "@type": "ImageObject",
        "url": "https://pixelog.net/img/pixelog.png",
        "width": 1200,
        "height": 630
      },
      "author": {
        "@type": "Person",
        "name": "<%= config.author %>"
      },
      "publisher": {
        "@type": "Organization",
        "name": "<%= config.title %>",
        "logo": {
          "@type": "ImageObject",
          "url": "https://pixelog.net/img/pixelog.png",
          "width": 1200,
          "height": 630
        }
      }
    }
    <% } %>
  ]
}
